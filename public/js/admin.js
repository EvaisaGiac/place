window.AdminTools={elements:{toolsContainer:$(".tools-container"),backupsContainer:$(".backups-container"),toolsToggle:$(".toggle-tools"),backupsToggle:$(".toggle-backups"),selection:$(".selection")},init:function(){this.backupList=null,this.startSelection=null,this.endSelection=null,this.elements.toolsToggle.click(function(){this.elements.toolsContainer.toggle(),this.elements.toolsContainer.is(":visible")&&this.elements.backupsContainer.hide()}.bind(this)),this.elements.backupsToggle.click(function(){this.elements.backupsContainer.toggle(),this.elements.backupsContainer.is(":visible")&&(this.elements.toolsContainer.hide(),null===this.backupList&&this.loadBackups())}.bind(this)),this.initSelectionTool(),this.initTools(),this.elements.toolsContainer.show()},initSelectionTool:function(){App.elements.board.on("mousemove",function(t){if(null!==this.startSelection&&null!==this.endSelection){var e=(this.endSelection.x-(this.startSelection.x-1))*App.scale,i=(this.endSelection.y-(this.startSelection.y-1))*App.scale,n=App.boardToScreenSpace(this.startSelection.x,this.startSelection.y);this.elements.selection.css("transform","translate("+n.x+"px, "+n.y+"px)"),this.elements.selection.css("width",e+"px").css("height",i+"px"),this.elements.selection.show()}else this.elements.selection.hide()}.bind(this))},initTools:function(){var t=$("<div>",{text:"Clear Square"});t.click(this.toolClearSquare.bind(this)),this.elements.toolsContainer.append(t)},toolClearSquare:function(){var t=$(".bubble-container").empty(),e=$("<div>",{class:"bubble",text:"Start Position",style:"cursor: pointer;"}),i=$("<div>",{class:"bubble",text:"End Position",style:"cursor: pointer;"}),n=$("<div>",{class:"bubble",text:"Clear Selection",style:"cursor: pointer;"}).hide(),s=$("<div>",{class:"bubble",text:"Delete Selection",style:"cursor: pointer;"}).hide();t.append(e),t.append(i),t.append(n),t.append(s);var o=function(t){t?(n.show(),s.show()):(n.hide(),s.hide())};e.click(function(){this.startSelection=null,e.text("Start Position"),o(!1)}.bind(this)),i.click(function(){this.endSelection=null,i.text("End Position"),o(!1)}.bind(this)),n.click(function(){e.click(),i.click()}),s.click(function(){$.post({url:"/admin/delete",data:{startx:this.startSelection.x,starty:this.startSelection.y,endx:this.endSelection.x,endy:this.endSelection.y}}),n.click()}.bind(this));var l,c;App.elements.boardContainer.on("mousedown",function(t){l=t.clientX,c=t.clientY}).on("click",function(t){l===t.clientX&&c===t.clientY&&(null===this.startSelection?(this.startSelection=App.screenToBoardSpace(t.clientX,t.clientY),e.text("Start: ("+this.startSelection.x+", "+this.startSelection.y+")")):null===this.endSelection&&(this.endSelection=App.screenToBoardSpace(t.clientX,t.clientY),i.text("End: ("+this.endSelection.x+", "+this.endSelection.y+")")),o(null!==this.startSelection&&null!==this.endSelection))}.bind(this))},loadBackups:function(){$.get("/admin/backups",function(t){t.forEach(function(t){console.log(t),$("<div>").text(t).appendTo(this.elements.backupsContainer)}.bind(this)),this.backupList=t}.bind(this))}},$.get("/js/app.js",function(t){$.get("/js/mod_tools.js",function(t){AdminTools.init()})});