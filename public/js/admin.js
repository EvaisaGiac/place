window.AdminTools={elements:{toolsContainer:$(".tools-container"),backupsContainer:$(".backups-container"),toolsToggle:$(".toggle-tools"),backupsToggle:$(".toggle-backups")},init:function(){this.backupList=null,this.currentBackup=null,this.backupBuffer=null,this.elements.toolsToggle.click(function(){this.elements.toolsContainer.toggle(),this.elements.toolsContainer.is(":visible")&&this.elements.backupsContainer.hide()}.bind(this)),this.elements.backupsToggle.click(function(){this.elements.backupsContainer.toggle(),this.elements.backupsContainer.is(":visible")&&(this.elements.toolsContainer.hide(),null===this.backupList&&this.loadBackups())}.bind(this)),this.initTools(),this.initContextMenus()},initTools:function(){var t=$("<div>",{text:"Clear Square"}),e=$("<div>",{text:"Restore Section"}),n=$("<div>",{text:"Return to live board"});e.click(function(){null!==this.backupBuffer&&ModTools.startSelectionMode(function(t,e){$.post({url:"/admin/restore",data:{startx:t.x,starty:t.y,endx:e.x,endy:e.y,filename:this.currentBackup}}).done(function(){n.click()}.bind(this))}.bind(this))}.bind(this)),t.click(this.toolClearSquare.bind(this)),n.click(function(){$.get("/boarddata",function(t){App.drawBoard(t),App.socket.connected||App.initSocket()}.bind(this))}.bind(this)),this.elements.toolsContainer.append(t),this.elements.toolsContainer.append(e),this.elements.toolsContainer.append(n)},toolClearSquare:function(){ModTools.startSelectionMode(function(t,e){$.post({url:"/admin/delete",data:{startx:t.x,starty:t.y,endx:e.x,endy:e.y}})}.bind(this))},loadBackups:function(){this.elements.backupsContainer.empty(),$.get("/admin/backups",function(t){t.forEach(function(t){var e=$("<div>",{class:"backup"}).text(t);e.click(function(){this.loadBackup(t)}.bind(this)),this.elements.backupsContainer.append(e)}.bind(this)),this.backupList=t}.bind(this)).fail(function(t){$("<div>").text("Failed to load backups: "+t.responseText).appendTo(this.elements.backupsContainer),console.log(error)}.bind(this))},loadBackup:function(t){App.alert(t),this.currentBackup=t,$.get("/admin/backup/"+t,function(t){var e=App.width*App.height;this.backupBuffer=new Uint32Array(e);for(var n=0;n<e;n++)this.backupBuffer[n]=t.charCodeAt(n);App.socket.close(),App.drawBoard(t)}.bind(this))},initContextMenus:function(){$.contextMenu({selector:".backup",trigger:"right",zIndex:1e3,items:{restore:{name:"Restore Entire Backup",callback:function(t,e){this.confirmBackupRestore(e.$trigger.text())}.bind(this)}}})},confirmBackupRestore:function(t){swal({title:"Restore "+t,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm"},function(){})}},AdminTools.init();