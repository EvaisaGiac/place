window.ModTools={elements:{bubbleContainer:$(".bubble-container"),spamEnabledDiv:$("<div>",{class:"bubble"}).text("Spam Enabled: false"),restrictedToggle:$("<div>",{class:"bubble restricted-toggle"}).text("Show Restricted Areas"),restrictionDiv:$("<div>",{class:"bubble"}).text("Create Restriction"),restrictionBackDiv:$("<div>",{class:"bubble"}).text("Exit Selection Mode"),startSelection:$("<div>",{class:"bubble",text:"Start Position",style:"cursor: pointer;"}),endSelection:$("<div>",{class:"bubble",text:"End Position",style:"cursor: pointer;"}),permaReticule:$("<div>",{class:"reticule"}).hide(),restrictSelection:$("<div>",{class:"bubble",text:"Restrict Selection",style:"cursor: pointer;"}).hide(),selectionBorder:$("<div>",{class:"selection"})},init:function(){this.reset(),this.initContextMenu(),this.initSpamBlocks(),this.initPermaReticule(),this.initSelectionMode(),App.alert("Moderation tools loaded"),setTimeout(function(){App.alert(null)}.bind(this),5e3)},reset:function(){this.spamBlocksEnabled=!1,this.selectionModeEnabled=!1,this.startSelection=null,this.endSelection=null,this.elements.startSelection.text("Start Position"),this.elements.endSelection.text("End Position"),this.elements.restrictSelection.hide(),this.initBubbles(),this.initRestrictions(),App.switchColor(-1),App.elements.palette.show(),this.elements.permaReticule.hide()},initPermaReticule:function(){$(".ui").append(this.elements.permaReticule),App.elements.board.on("mousemove",function(e){var t=App.screenToBoardSpace(e.clientX,e.clientY);t.x|=0,t.y|=0;var i=App.boardToScreenSpace(t.x,t.y);this.elements.permaReticule.css("transform","translate("+i.x+"px, "+i.y+"px)"),this.elements.permaReticule.css("width",App.scale+"px").css("height",App.scale+"px")}.bind(this))},initSelectionMode:function(){$(".ui").append(this.elements.selectionBorder),App.elements.board.on("mousemove",function(e){if(this.selectionModeEnabled&&null!==this.startSelection&&null!==this.endSelection){var t=(this.endSelection.x-(this.startSelection.x-1))*App.scale,i=(this.endSelection.y-(this.startSelection.y-1))*App.scale,n=App.boardToScreenSpace(this.startSelection.x,this.startSelection.y);this.elements.selectionBorder.css("transform","translate("+n.x+"px, "+n.y+"px)"),this.elements.selectionBorder.css("width",t+"px").css("height",i+"px"),this.elements.selectionBorder.show()}else this.elements.selectionBorder.hide()}.bind(this)),App.elements.boardContainer.on("mousedown",function(e){downX=e.clientX,downY=e.clientY}).on("click",function(e){this.selectionModeEnabled&&downX===e.clientX&&downY===e.clientY&&(null===this.startSelection?(this.startSelection=App.screenToBoardSpace(e.clientX,e.clientY),this.elements.startSelection.text("Start: ("+this.startSelection.x+", "+this.startSelection.y+")")):(this.endSelection=App.screenToBoardSpace(e.clientX,e.clientY),this.elements.endSelection.text("End: ("+this.endSelection.x+", "+this.endSelection.y+")")),null!==this.startSelection&&null!==this.endSelection&&this.elements.restrictSelection.show())}.bind(this))},initBubbles:function(){this.elements.bubbleContainer.empty(),this.elements.bubbleContainer.append(this.elements.spamEnabledDiv),this.elements.bubbleContainer.append(this.elements.restrictionDiv),App.elements.restrictedToggle=this.elements.restrictedToggle,this.elements.bubbleContainer.append(this.elements.restrictedToggle),this.elements.restrictedToggle.click(App.restrictedAreaToggle.bind(App))},initSpamBlocks:function(){var e=-1,t=-1;App.elements.board.on("mousemove",function(i){var n=App.screenToBoardSpace(i.clientX,i.clientY),s=!1;e!=n.x&&(s=!0,e=n.x),t!=n.y&&(s=!0,t=n.y),s&&this.spamBlocksEnabled&&App.place(e,t)}.bind(this)),$(document).on("mousedown",function(i){2==i.which&&(this.spamBlocksEnabled=!this.spamBlocksEnabled,this.elements.spamEnabledDiv.text("Spam Enabled: "+this.spamBlocksEnabled),-1!==e&&-1!==t&&App.place(e,t),i.preventDefault())}.bind(this))},initRestrictions:function(){this.elements.restrictionDiv.click(function(){this.reset(),App.elements.palette.hide(),this.elements.permaReticule.show(),this.elements.bubbleContainer.empty(),this.elements.bubbleContainer.append(this.elements.restrictionBackDiv),this.elements.bubbleContainer.append(this.elements.startSelection),this.elements.bubbleContainer.append(this.elements.endSelection),this.elements.bubbleContainer.append(this.elements.restrictSelection),this.elements.startSelection.click(function(){this.startSelection=null,this.elements.startSelection.text("Start Position"),this.elements.restrictSelection.hide()}.bind(this)),this.elements.restrictSelection.click(this.restrictSelection.bind(this)),this.selectionModeEnabled=!0}.bind(this)),this.elements.restrictionBackDiv.click(function(){this.reset()}.bind(this))},restrictSelection:function(){App.socket.send(JSON.stringify({type:"restriction",start:this.startSelection,end:this.endSelection})),this.reset()},initContextMenu:function(){$.contextMenu("destroy"),$.contextMenu({selector:".username",trigger:"right",zIndex:1e3,items:{spectate:{name:"Spectate",callback:function(e,t){App.spectate(t.$trigger.text())}},sep1:"",cooldown:{name:"Cooldown",callback:function(e,t){App.socket.send(JSON.stringify({type:"cooldown",session_id:t.$trigger.text()}))}},ban:{name:"Ban",callback:function(e,t){App.socket.send(JSON.stringify({type:"ban",session_id:t.$trigger.text()}))}}}})}},ModTools.init();